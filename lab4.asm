LJMP START
P5 equ 0F8H
P7 equ 0DBH

; LCD registers ----------------------------------
LCDstatus equ 0FF2EH
LCDcontrol equ 0FF2CH
LCDdataWR equ 0FF2DH
LCDdataRD equ 0FF2FH

// LCD control bytes ----------------------------------
#define HOME 0x80 // put curcor to first line
#define INITDISP 0x38 // LCD init (8-bit mode)
#define HOM2 0xc0 // put curcor to second line
#define LCDON 0x0e // LCD nn, cursor off, blinking off
#define CLEAR 0x01 // LCD display clear

ORG 0100H

LCDcntrlWR MACRO x
LOCAL loop
loop:
MOV DPTR,#LCDstatus
MOVX A,@DPTR
JB ACC.7,loop ; check if LCD busy

MOV DPTR,#LCDcontrol ; write to LCD control
MOV A, x
MOVX @DPTR,A
ENDM

LCDcharWR MACRO
LOCAL loop1,loop2

PUSH ACC
loop1: MOV DPTR,#LCDstatus
MOVX A,@DPTR
JB ACC.7,loop1 ; check if LCD busy

loop2: MOV DPTR,#LCDdataWR ; write data to LCD
POP ACC
MOVX @DPTR,A
ENDM

init_LCD MACRO
LCDcntrlWR #INITDISP
LCDcntrlWR #CLEAR
LCDcntrlWR #LCDON
ENDM


START:
init_LCD
LICZNIK1:
MOV R7,#10H
START1:
MOV DPH,#80H
MOV DPL,#01110111B
MOV A,#31H
;CPL A
MOVX @DPTR,A
MOV DPL,#01111011B
MOV A,#32H
;CPL A
MOVX @DPTR,A
MOV DPL,#01111101B
MOV A,#33H
;CPL A
MOVX @DPTR,A
MOV DPL,#01111110B
MOV A,#41H
;CPL A
MOVX @DPTR,A
MOV DPL,#10110111B
MOV A,#34H
;CPL A
MOVX @DPTR,A
MOV DPL,#10111011B
MOV A,#35H
;CPL A
MOVX @DPTR,A
MOV DPL,#10111101B
MOV A,#36H
;CPL A
MOVX @DPTR,A
MOV DPL,#10111110B
MOV A,#42H
;CPL A
MOVX @DPTR,A
MOV DPL,#11010111B
MOV A,#37H
;CPL A
MOVX @DPTR,A
MOV DPL,#11011011B
MOV A,#38H
;CPL A
MOVX @DPTR,A
MOV DPL,#11011101B
MOV A,#39H
;CPL A
MOVX @DPTR,A
MOV DPL,#11011110B
MOV A,#43H
;CPL A
MOVX @DPTR,A
MOV DPL,#11100111B
MOV A,#2AH
;CPL A
MOVX @DPTR,A
MOV DPL,#11101011B
MOV A,#30H
;CPL A
MOVX @DPTR,A
MOV DPL,#11101101B
MOV A,#23H
;CPL A
MOVX @DPTR,A
MOV DPL,#11101110B
MOV A,#44H
;CPL A
MOVX @DPTR,A


W1:
MOV R0,#7FH

MOV A,R0
MOV P5,A
MOV A,P7
ANL A,R0
MOV R2,A
CLR C
SUBB A,R0
JZ W2
MOV A,R2
MOV DPH,#80H
MOV DPL,A
MOVX A,@DPTR
MOV P1,A
MOV R4,#0FFH
TU3:MOV R5,#0FFH
TAM3:DJNZ R5,TAM3
DJNZ R4,TU3
LCDcharWR
W2:
MOV R0,#0BFH
MOV A,R0
MOV P5,A
MOV A,P7
ANL A,R0
MOV R2,A
CLR C
SUBB A,R0
JZ W3
MOV A,R2
MOV DPH,#80H
MOV DPL,A
MOVX A,@DPTR
MOV P1,A
MOV R4,#0FFH
TU4:MOV R5,#0FFH
TAM4:DJNZ R5,TAM4
DJNZ R4,TU4
LCDcharWR
W3:
MOV R0,#0DFH
MOV A,R0
MOV P5,A
MOV A,P7
ANL A,R0
MOV R2,A
CLR C
SUBB A,R0
JZ W4
MOV A,R2
MOV DPH,#80H
MOV DPL,A
MOVX A,@DPTR
MOV P1,A
MOV R4,#0FFH
TU5:MOV R5,#0FFH
TAM5:DJNZ R5,TAM5
DJNZ R4,TU5
LCDcharWR
W4:
MOV R0,#0EFH
MOV A,R0
MOV P5,A
MOV A,P7
ANL A,R0
MOV R2,A
CLR C
SUBB A,R0
JZ W12
MOV A,R2
MOV DPH,#80H
MOV DPL,A
MOVX A,@DPTR
MOV P1,A
MOV R4,#0FFH
TU6:MOV R5,#0FFH
TAM6:DJNZ R5,TAM6
DJNZ R4,TU6
JMP c1
W12: JMP W1
c1:
LCDcharWR

;DJNZ R7,START12
JMP C2
START12:
JMP START1
C2:
;LCDcntrlWR #HOM2
JMP LICZNIK1
/*
MOV A,#41H
LCDcharWR
MOV A,#6CH
LCDcharWR
MOV A,#61H
LCDcharWR
MOV A,#20H
LCDcharWR
MOV A,#6DH
LCDcharWR
MOV A,#61H
LCDcharWR
MOV A,#20H
LCDcharWR
MOV A,#31H
LCDcharWR
MOV A,#30H
LCDcharWR
MOV A,#30H
LCDcharWR
MOV A,#24H
LCDcharWR
MOV A,#2CH
LCDcharWR
LCDcntrlWR #HOM2
MOV A,#61H
LCDcharWR
MOV A,#20H
LCDcharWR
MOV A,#4AH
LCDcharWR
MOV A,#61H
LCDcharWR
MOV A,#6EH
LCDcharWR
MOV A,#20H
LCDcharWR
MOV A,#33H
LCDcharWR
MOV A,#30H
LCDcharWR
MOV A,#30H
LCDcharWR
MOV A,#24H
LCDcharWR 

MOV DPTR,#8001H
MOV A,#6BH
MOVX @DPTR,A
INC DPTR
MOV A,#61H
MOVX @DPTR,A
INC DPTR
MOV A,#6EH
MOVX @DPTR,A
INC DPTR
MOV A,#61H
MOVX @DPTR,A
INC DPTR
MOV A,#72H
MOVX @DPTR,A
INC DPTR
MOV A,#32H
MOVX @DPTR,A
INC DPTR
MOV A,#33H
MOVX @DPTR,A
INC DPTR

MOV A,#57H
MOVX @DPTR,A
INC DPTR
MOV A,#69H
MOVX @DPTR,A
INC DPTR
MOV A,#74H
MOVX @DPTR,A
INC DPTR
MOV A,#61H
MOVX @DPTR,A
INC DPTR
L2:
init_LCD

MOV R1,#7H
MOV DPTR,#8001H
MOV R0,#01H
LOOP:
MOV DPH,#80H
MOV A,R0
MOV DPL,A
MOVX A,@DPTR
LCDcharWR
MOV R2,#0FFH
TU:MOV R3,#0FFH
TAM:DJNZ R3,TAM
DJNZ R2,TU
INC R0
DJNZ R1,LOOP	  

LCDcntrlWR #HOM2

MOV R1,#4H
MOV DPTR,#8008H
MOV R0,#08H
LOOP2:
MOV DPH,#80H
MOV A,R0
MOV DPL,A
MOVX A,@DPTR
LCDcharWR
MOV R2,#0FFH
TU2:MOV R3,#0FFH
TAM2:DJNZ R3,TAM2
DJNZ R2,TU2
INC R0
DJNZ R1,LOOP2
MOV R4,#0FFH
TU3:MOV R5,#0FFH
TAM3:DJNZ R5,TAM3
DJNZ R4,TU3
JMP L2	 */

NOP
NOP
NOP
JMP $
END START


 